<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0, interactive-widget=overlays-content">
    <title>聊天 - 个人博客</title>
    <title>聊天 - 个人博客</title>
    <link rel="icon" type="image/svg+xml" href="images/favicon.svg">
    <link rel="icon" type="image/png" href="images/favicon.png">
    <link rel="stylesheet" href="/css/common.css">
    <script src="/js/config.js"></script>
    <script src="/js/common.js"></script>
    <style>
        * {
            box-sizing: border-box;
        }
        
        .main-content { 
            max-width: 1000px; 
            margin: 5rem auto 3rem; 
            padding: 0 20px; 
        }
        
        .page-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .page-title { 
            font-size: 32px; 
            font-weight: 600; 
            color: #1a1a1a;
            margin-bottom: 8px;
            letter-spacing: -0.5px;
        }
        
        .page-subtitle {
            font-size: 15px;
            color: #666;
            font-weight: 400;
        }
        
        /* 卡片网格布局 */
        .cards-grid { 
            display: grid; 
            grid-template-columns: repeat(2, 1fr); 
            gap: 20px; 
            margin-bottom: 40px;
        }
        
        /* 卡片样式 */
        .feature-card { 
            background: #fff;
            border: 1px solid #e8e8e8;
            border-radius: 16px;
            padding: 32px 28px;
            text-align: center;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }
        
        .feature-card:hover {
            border-color: #d0d0d0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            transform: translateY(-2px);
        }
        
        /* 图标容器 */
        .icon-wrapper {
            width: 72px;
            height: 72px;
            margin: 0 auto 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            transition: all 0.25s ease;
        }
        
        .icon-wrapper::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0) 100%);
        }
        
        .icon-wrapper svg {
            width: 36px;
            height: 36px;
            position: relative;
            z-index: 1;
        }
        
        .feature-card:hover .icon-wrapper {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
        }
        
        /* Android卡片专属渐变 */
        #androidCard .icon-wrapper {
            background: linear-gradient(135deg, #3ddc84 0%, #07c160 100%);
        }
        
        #androidCard .icon-wrapper:hover {
            box-shadow: 0 8px 16px rgba(61, 220, 132, 0.3);
        }
        
        /* 预览卡片专属渐变 */
        #previewCard .icon-wrapper {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        #previewCard .icon-wrapper:hover {
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
        }
        
        .card-title { 
            font-size: 20px; 
            font-weight: 600; 
            color: #1a1a1a;
            margin-bottom: 8px;
        }
        
        .card-description { 
            font-size: 14px; 
            color: #666;
            margin-bottom: 20px;
            line-height: 1.5;
        }
        
        /* 按钮样式 */
        .card-button { 
            background: #1a1a1a;
            color: #fff;
            border: none;
            padding: 12px 28px;
            border-radius: 10px;
            font-weight: 500;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 100%;
        }
        
        .card-button:hover { 
            background: #000;
            transform: translateY(-1px);
        }
        
        .card-button:active {
            transform: translateY(0);
        }
        
        .card-button:disabled { 
            background: #e8e8e8;
            color: #999;
            cursor: not-allowed;
            transform: none;
        }
        
        /* 需要登录标识 */
        .login-badge {
            display: inline-block;
            background: #ff6b35;
            color: #fff;
            font-size: 11px;
            padding: 4px 10px;
            border-radius: 12px;
            margin-bottom: 12px;
            font-weight: 500;
            letter-spacing: 0.3px;
        }
        
        /* 版本信息样式 */
        .version-info { 
            background: #f8f8f8;
            border-radius: 12px;
            padding: 16px;
            margin-top: 20px;
            text-align: left;
        }
        
        .version-title { 
            font-size: 14px; 
            font-weight: 600; 
            color: #1a1a1a;
            margin-bottom: 8px;
        }
        
        .release-notes { 
            font-size: 13px; 
            color: #666;
            line-height: 1.5;
            white-space: pre-wrap;
            margin-bottom: 10px;
        }
        
        .meta { 
            font-size: 12px; 
            color: #999;
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .meta-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .meta-item::before {
            content: '·';
            color: #999;
            font-weight: 700;
        }
        
        .meta-item:first-child::before {
            content: '';
        }
        
        .loading, .error { 
            text-align: center;
            padding: 16px;
            font-size: 13px;
        }
        
        .loading {
            color: #999;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .loading::before {
            content: '';
            width: 16px;
            height: 16px;
            border: 2px solid #f0f0f0;
            border-top: 2px solid #999;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        .error { 
            color: #ff4444;
        }
        
        /* 响应式设计 - 平板 */
        @media (max-width: 768px) {
            .main-content { 
                margin-top: 4rem;
                padding: 0 16px;
            }
            
            .page-title {
                font-size: 28px;
            }
            
            .page-subtitle {
                font-size: 14px;
            }
            
            .page-header {
                margin-bottom: 32px;
            }
            
            .cards-grid { 
                gap: 16px;
            }
            
            .feature-card { 
                padding: 28px 24px;
            }
            
            .icon-wrapper {
                width: 64px;
                height: 64px;
                margin-bottom: 20px;
            }
            
            .icon-wrapper svg {
                width: 32px;
                height: 32px;
            }
            
            .card-title {
                font-size: 18px;
            }
            
            .card-description {
                font-size: 13px;
            }
            
            .card-button {
                padding: 11px 24px;
                font-size: 13px;
            }
        }
        
        /* 响应式设计 - 手机 */
        @media (max-width: 600px) {
            .main-content { 
                margin-top: 3.5rem;
                padding: 0 12px;
            }
            
            .page-title {
                font-size: 24px;
            }
            
            .page-header {
                margin-bottom: 28px;
            }
            
            .cards-grid { 
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .feature-card { 
                padding: 28px 24px;
            }
            
            .icon-wrapper {
                width: 56px;
                height: 56px;
            }
            
            .icon-wrapper svg {
                width: 28px;
                height: 28px;
            }
            
            .card-title {
                font-size: 18px;
            }
            
            .card-description {
                font-size: 13px;
                margin-bottom: 18px;
            }
            
            .card-button {
                padding: 12px 24px;
            }
            
            .version-info {
                padding: 14px;
            }
            
            .phone-close {
                top: 16px;
                right: 16px;
                width: 36px;
                height: 36px;
                font-size: 16px;
            }
        }
        
        /* 超小屏幕 */
        @media (max-width: 380px) {
            .main-content {
                padding: 0 10px;
            }
            
            .feature-card {
                padding: 24px 20px;
            }
            
            .cards-grid {
                gap: 12px;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <a href="/" class="nav-brand">szhAo-blog</a>
            <button class="menu-toggle" aria-label="切换菜单">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <div class="nav-links">
                <a href="/">首页</a>
                <a href="/tools.html">工具集</a>
                <a href="/chat.html" class="active">聊天</a>
                <a href="/message.html">留言</a>
                <a href="/about.html">关于</a>
            </div>
            <div class="auth-buttons">
                <button class="btn-outline" id="loginBtn">登录</button>
                <button class="btn-primary" id="registerBtn">注册</button>
            </div>
        </div>
    </nav>

    <main class="main-content">
        <div class="page-header">
            <h1 class="page-title">聊天体验</h1>
            <p class="page-subtitle">多平台智能对话，随时随地畅聊无阻</p>
        </div>
        
        <div id="buttonContainer" class="cards-grid">
            <!-- 安卓卡片 -->
            <div class="feature-card" id="androidCard">
                <div class="icon-wrapper">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M17.5 9.5H6.5C5.67157 9.5 5 10.1716 5 11V18C5 18.8284 5.67157 19.5 6.5 19.5H17.5C18.3284 19.5 19 18.8284 19 18V11C19 10.1716 18.3284 9.5 17.5 9.5Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M7 9.5V6.5C7 5.57174 7.36875 4.6815 8.02513 4.02513C8.6815 3.36875 9.57174 3 10.5 3H13.5C14.4283 3 15.3185 3.36875 15.9749 4.02513C16.6313 4.6815 17 5.57174 17 6.5V9.5" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <circle cx="12" cy="14.5" r="1.5" fill="white"/>
                    </svg>
                </div>
                <div class="card-title">安卓应用</div>
                <div class="card-description">下载原生应用，享受流畅的移动端聊天体验</div>
                <button class="card-button" id="downloadApk">立即下载</button>
                <div id="androidVersion" class="version-info" style="display: none;">
                    <div class="loading">正在获取最新版本...</div>
                </div>
            </div>

            <!-- 预览卡片 -->
            <div class="feature-card" id="previewCard">
                <div class="icon-wrapper">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="3" y="4" width="18" height="16" rx="2" stroke="white" stroke-width="2"/>
                        <path d="M3 8H21" stroke="white" stroke-width="2"/>
                        <circle cx="6.5" cy="6" r="0.5" fill="white"/>
                        <circle cx="8.5" cy="6" r="0.5" fill="white"/>
                        <circle cx="10.5" cy="6" r="0.5" fill="white"/>
                        <path d="M8 13L10 15L16 11" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
                <div class="card-title">在线预览</div>
                <div class="card-description">无需下载，登录后即可在浏览器中体验聊天功能</div>
                <button class="card-button" id="previewBtn">开始预览</button>
                <div class="version-info">
                    <div class="version-title">Web 版本 v2.1.0</div>
                    <div class="release-notes">支持实时对话、消息同步、多设备无缝切换</div>
                    <div class="meta">
                        <span class="meta-item">PWA 支持</span>
                        <span class="meta-item">无需安装</span>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-links">
                <a href="/">首页</a> |
                <a href="/message.html">留言</a> |
                <a href="/about.html">关于</a> |
                <span>© 2024 个人博客</span>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const androidVersionEl = document.getElementById('androidVersion');
            const downloadApkBtn = document.getElementById('downloadApk');
            
            (async function loadAndroidVersion() {
                try {
                    androidVersionEl.innerHTML = '<div class="loading">正在获取最新版本</div>';
                    androidVersionEl.style.display = 'block';
                    const res = await fetch('https://android.szhaovo.cn/api/versions/latest', { cache: 'no-store' });
                    const j = await res.json();
                    if (j && j.data) {
                        const d = j.data;
                        const sizeMB = d.file_size ? (d.file_size / 1024 / 1024).toFixed(2) : '';
                        androidVersionEl.innerHTML = `
                            <div class="version-title">版本 ${d.version_name} (${d.version_code})</div>
                            <div class="release-notes">${d.release_notes || '最新稳定版本'}</div>
                            <div class="meta">
                                ${sizeMB ? `<span class="meta-item">大小 ${sizeMB} MB</span>` : ''}
                                <span class="meta-item">SDK ${d.target_sdk_version}</span>
                            </div>
                        `;
                        downloadApkBtn.dataset.url = d.apk_url;
                    } else {
                        androidVersionEl.innerHTML = '<div class="error">未获取到版本信息</div>';
                    }
                } catch (e) {
                    androidVersionEl.innerHTML = '<div class="error">获取版本信息失败</div>';
                }
            })();

            // 下载按钮事件
            downloadApkBtn.addEventListener('click', () => {
                const url = downloadApkBtn.dataset.url;
                if (url) {
                    window.open(url, '_blank');
                }
            });

            // 获取本地token
            function getLocalToken() {
                return localStorage.getItem('token') || 
                       localStorage.getItem('authToken') || 
                       localStorage.getItem('userToken') ||
                       sessionStorage.getItem('token') || 
                       sessionStorage.getItem('authToken') || 
                       sessionStorage.getItem('userToken') || '';
            }

            // 预览按钮事件 - 改为浏览器自动跳转
            const previewBtn = document.getElementById('previewBtn');
            previewBtn.addEventListener('click', () => {
                const token = getLocalToken();
                if (!token) {
                    alert('请先登录后再使用预览功能');
                    return;
                }
                const url = `https://newebchat.pages.dev/?token=${encodeURIComponent(token)}`;
                window.open(url, '_blank'); // 浏览器自动跳转，新标签页打开
            });

            // 检查登录状态并更新UI
            function updatePreviewButton() {
                const token = getLocalToken();
                const previewBtn = document.getElementById('previewBtn');
                if (!token) {
                    previewBtn.textContent = '请先登录';
                    previewBtn.style.opacity = '0.7';
                } else {
                    previewBtn.textContent = '开始预览';
                    previewBtn.style.opacity = '1';
                }
            }

            updatePreviewButton();
            setInterval(updatePreviewButton, 3000);
        });
    </script>
</body>
</html>
